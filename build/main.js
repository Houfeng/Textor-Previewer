/*csd*/define(function(require,exports,module){var h=exports;var d=require("self/utils/menu");var k=require("mokit/store");var l=require("mokit/utils");var i=require_node(require.toUrl("./lib/server"));var f=require_node(require.toUrl("./lib/parser/md_parser"));var e=require_node(require.toUrl("./lib/parser/less_parser"));i.fileParser["markdown"]=f;i.fileParser["less"]=e;var b=null;var a=null;var j={};var g="web-preview-port-index";var c=function(){var m=(k.session.get(g)||10000)+1;k.session.set(g,m);return m;};h.onReady=function(m){a=m;};h.onCreateContextMenu=function(m){var o=new d.MenuItem({type:"separator"});var n=new d.MenuItem({label:"Web Preview",click:function(){if(b){j[b.path]=j[b.path]||new i({"path":b.path,"port":c(),"config":"/web.json"});var q=j[b.path]||{};try{q.stop();q.start();}catch(p){}a.shell.openExternal("http://localhost:"+q.port);}}});l.async(function(){m.finder.append(o);m.finder.append(n);},1000);m.finder.onPopup(function(){b=m.finder.finderItem;n.enabled=b.isRoot&&(b.type=="dir");});};});